{"ast":null,"code":"import _classCallCheck from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Volumes/Angela He/treehacks/src/components/User/DeleteAccount.js\";\nimport React, { Component } from 'react';\nimport Loading from '../Misc/Loading';\n/*\nfirebase\nthis uid\nremoveUser\n*/\n\nvar deleteStates = {\n  NONE: {},\n  POPUP: {\n    title: 'Are you sure?',\n    p: 'If you delete your account, all your user data will be permanently deleted.'\n  },\n  REAUTH: {\n    title: 'Re-enter your password.',\n    p: 'We need to verify you\\'re the owner of this account.' //input password\n\n  },\n  DELETING: {//loading icon\n  },\n  DELETED: {\n    title: 'Your account is deleted.',\n    p: 'Have a great rest of your day.' //ok\n\n  },\n  FAILED: {\n    title: 'Your account could not be deleted.',\n    p: 'Check your connection and try again.'\n  }\n};\n/*\ntitle\np\nfooter\n*/\n\nvar DeleteModal = function DeleteModal(props) {\n  var t = props.title == null ? null : React.createElement(\"h1\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42\n    },\n    __self: this\n  }, props.title);\n  var p = props.p == null ? null : React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43\n    },\n    __self: this\n  }, props.p);\n  return React.createElement(\"div\", {\n    className: \"modal-bg\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"modal\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46\n    },\n    __self: this\n  }, t, p, props.footer));\n};\n\nvar DeleteAccount =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(DeleteAccount, _React$Component);\n\n  function DeleteAccount(_props) {\n    var _this;\n\n    _classCallCheck(this, DeleteAccount);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DeleteAccount).call(this, _props));\n\n    _this.setDeleteState = function (dState) {\n      _this.setState({\n        deleteState: dState\n      });\n    };\n\n    _this.setPassword = function (e) {\n      _this.setState({\n        password: e.target.value\n      });\n    };\n\n    _this.verifyAndDelete = function () {\n      _this.setDeleteState(deleteStates.DELETING);\n\n      var user = _this.props.firebase.auth.currentUser;\n\n      var credential = _this.props.firebase.auth.EmailAuthProvider.credential(user.email, _this.state.password); // re-authenticate user\n\n\n      user.reauthenticateAndRetrieveDataWithCredential(credential).then(function () {\n        /*\n          if couldn't delete user, show failed. \n          if deleted user but couldn't delete data, show success.\n          if deleted everything, show success.\n        */\n        //delete user\n        user.delete().then(function () {\n          //delete user data\n          props.firebase.user(_this.props.uid).delete().then(function () {\n            _this.finishAndSignOut();\n          }).catch(function (error) {\n            _this.finishAndSignOut();\n          });\n        }).catch(function (error) {\n          _this.setDeleteState(deleteStates.FAILED);\n        });\n      }).catch(function (error) {\n        _this.setDeleteState(deleteStates.FAILED);\n      });\n    };\n\n    _this.finishAndSignOut = function () {\n      _this.setDeleteState(deleteStates.DELETED);\n    };\n\n    _this.state = {\n      deleteState: deleteStates.NONE,\n      password: ''\n    };\n    return _this;\n  }\n\n  _createClass(DeleteAccount, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var dButton = React.createElement(\"button\", {\n        className: \"delete-but\",\n        onClick: function onClick() {\n          props.removeUser();\n          props.firebase.doDelete(c, cb);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, \"Delete account\");\n      var footer = null;\n\n      switch (this.state.deleteState) {\n        case deleteStates.NONE:\n          return React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123\n            },\n            __self: this\n          }, dButton);\n\n        case deleteStates.POPUP:\n          footer = React.createElement(\"footer\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 126\n            },\n            __self: this\n          }, React.createElement(\"button\", {\n            onClick: function onClick() {\n              return _this2.setDeleteState(deleteStates.REAUTH);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127\n            },\n            __self: this\n          }, \"Yes\"), React.createElement(\"button\", {\n            onClick: function onClick() {\n              return _this2.setDeleteState(deleteStates.NONE);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 128\n            },\n            __self: this\n          }, \"No\"));\n          return;\n\n        case deleteStates.REAUTH:\n          footer = React.createElement(\"footer\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 133\n            },\n            __self: this\n          }, React.createElement(\"input\", {\n            type: \"password\",\n            placeholder: \"Password\",\n            onChange: this.setPassword,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }), React.createElement(\"button\", {\n            onClick: this.verifyAndDelete,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 135\n            },\n            __self: this\n          }, \"Delete\"));\n          return;\n\n        case deleteStates.DELETING:\n          footer = React.createElement(Loading, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 140\n            },\n            __self: this\n          });\n          return;\n\n        case deleteStates.DELETED:\n          footer = React.createElement(\"footer\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 145\n            },\n            __self: this\n          }, React.createElement(\"button\", {\n            onClick: this.props.removeUser,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 146\n            },\n            __self: this\n          }, \"Ok\"));\n          return;\n\n        case deleteStates.FAILED:\n          footer = React.createElement(\"footer\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 152\n            },\n            __self: this\n          }, React.createElement(\"button\", {\n            onClick: function onClick() {\n              return _this2.setDeleteState(deleteStates.NONE);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 153\n            },\n            __self: this\n          }, \"Ok\"));\n          return;\n      }\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, dButton, React.createElement(DeleteModal, {\n        title: this.state.deleteState.title,\n        p: this.state.deleteState.p,\n        footer: footer,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return DeleteAccount;\n}(React.Component);\n\nexport default DeleteAccount;","map":{"version":3,"sources":["/Volumes/Angela He/treehacks/src/components/User/DeleteAccount.js"],"names":["React","Component","Loading","deleteStates","NONE","POPUP","title","p","REAUTH","DELETING","DELETED","FAILED","DeleteModal","props","t","footer","DeleteAccount","setDeleteState","dState","setState","deleteState","setPassword","e","password","target","value","verifyAndDelete","user","firebase","auth","currentUser","credential","EmailAuthProvider","email","state","reauthenticateAndRetrieveDataWithCredential","then","delete","uid","finishAndSignOut","catch","error","dButton","removeUser","doDelete","c","cb"],"mappings":"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","sourcesContent":["\nimport React, { Component } from 'react';\nimport Loading from '../Misc/Loading'\n\n/*\nfirebase\nthis uid\nremoveUser\n*/\nconst deleteStates = {\n  NONE: {},\n  POPUP: {\n    title: 'Are you sure?',\n    p: 'If you delete your account, all your user data will be permanently deleted.'\n  },\n  REAUTH: {\n    title: 'Re-enter your password.',\n    p: 'We need to verify you\\'re the owner of this account.'\n    //input password\n  },\n  DELETING: {\n    //loading icon\n  },\n  DELETED: {\n    title: 'Your account is deleted.',\n    p: 'Have a great rest of your day.'\n    //ok\n  },\n  FAILED: {\n    title: 'Your account could not be deleted.',\n    p: 'Check your connection and try again.'\n  }\n};\n\n\n/*\ntitle\np\nfooter\n*/\nconst DeleteModal = (props) => {\n  let t = props.title == null ? null : <h1>{props.title}</h1>;\n  let p = props.p == null ? null : <span>{props.p}</span>;\n\n  return <div className=\"modal-bg\">\n    <div className=\"modal\">\n      {t}\n      {p}\n      {props.footer}\n    </div>\n  </div>\n}\n\nclass DeleteAccount extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      deleteState: deleteStates.NONE,\n      password: ''\n    };\n  }\n\n  setDeleteState = (dState) => {\n    this.setState({ deleteState: dState })\n  }\n\n  setPassword = (e) => {\n    this.setState({ password: e.target.value })\n  }\n\n  verifyAndDelete = () => {\n    this.setDeleteState(deleteStates.DELETING)\n\n    const user = this.props.firebase.auth.currentUser;\n    const credential = this.props.firebase.auth.EmailAuthProvider.credential(\n      user.email,\n      this.state.password\n    );\n\n    // re-authenticate user\n    user.reauthenticateAndRetrieveDataWithCredential(credential).then(() => {\n\n      /*\n        if couldn't delete user, show failed. \n        if deleted user but couldn't delete data, show success.\n        if deleted everything, show success.\n      */\n      //delete user\n      user.delete().then(() => {\n\n        //delete user data\n        props.firebase.user(this.props.uid).delete().then(() => {\n          this.finishAndSignOut();\n        }).catch((error) => {\n          this.finishAndSignOut();\n        });\n\n      }).catch((error) => {\n        this.setDeleteState(deleteStates.FAILED)\n      });\n\n    }).catch((error) => {\n      this.setDeleteState(deleteStates.FAILED)\n    });\n  }\n\n  finishAndSignOut = () => {\n    this.setDeleteState(deleteStates.DELETED)\n  }\n\n  render() {\n    let dButton = (\n      <button className=\"delete-but\"\n        onClick={() => {\n          props.removeUser();\n          props.firebase.doDelete(c, cb);\n        }}>Delete account</button>\n    );\n    let footer = null;\n\n    switch (this.state.deleteState) {\n      case deleteStates.NONE:\n        return <div>{dButton}</div>;\n      case deleteStates.POPUP:\n        footer =\n          <footer>\n            <button onClick={() => this.setDeleteState(deleteStates.REAUTH)}>Yes</button>\n            <button onClick={() => this.setDeleteState(deleteStates.NONE)}>No</button>\n          </footer>;\n        return;\n      case deleteStates.REAUTH:\n        footer =\n          <footer>\n            <input type=\"password\" placeholder=\"Password\" onChange={this.setPassword} />\n            <button onClick={this.verifyAndDelete}>Delete</button>\n          </footer>\n        return;\n      case deleteStates.DELETING:\n        footer =\n          <Loading />\n          ;\n        return;\n      case deleteStates.DELETED:\n        footer =\n          <footer>\n            <button onClick={this.props.removeUser}>Ok</button>\n          </footer>\n          ;\n        return;\n      case deleteStates.FAILED:\n        footer =\n          <footer>\n            <button onClick={() => this.setDeleteState(deleteStates.NONE)}>Ok</button>\n          </footer>\n          ;\n        return;\n    }\n    return <div>\n      {dButton}\n      <DeleteModal\n        title={this.state.deleteState.title}\n        p={this.state.deleteState.p}\n        footer={footer}\n      />\n    </div>;\n  }\n}\n\n\nexport default DeleteAccount;"]},"metadata":{},"sourceType":"module"}