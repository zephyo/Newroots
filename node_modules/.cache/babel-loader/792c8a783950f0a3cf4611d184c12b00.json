{"ast":null,"code":"import _classCallCheck from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Volumes/Angela He/treehacks/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Volumes/Angela He/treehacks/src/components/Network/AddFriend.js\";\nimport React from 'react';\nimport plant from '../../graphics/icon.png';\nimport $ from 'jquery';\nimport Avatar from '../Misc/Avatar';\nimport UserRow from './UserRow';\nimport ListOfUsers from './ListOfUsers';\n\nvar AddFriend =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(AddFriend, _React$Component);\n\n  function AddFriend(props) {\n    var _this;\n\n    _classCallCheck(this, AddFriend);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AddFriend).call(this, props));\n\n    _this.setAddedFriend = function (mssg) {\n      _this.setState({\n        addedFriend: mssg\n      });\n    };\n\n    _this.setInvitedFriend = function (mssg) {\n      _this.setState({\n        invitedFriend: mssg\n      });\n    };\n\n    _this.validateEmail = function (email) {\n      var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n      return re.test(String(email).toLowerCase());\n    };\n\n    _this.genList = function (ref, search_val) {\n      var tempSug = [];\n      ref.get().then(function (querySnapshot) {\n        querySnapshot.forEach(function (doc) {\n          // doc.data() is never undefined for query doc snapshots\n          console.log(doc.id, \" => \", doc.data());\n          tempSug.push({\n            uid: doc.id,\n            name: doc.data().name,\n            url: doc.data().PpfURL\n          });\n        });\n\n        _this.setState({\n          suggestions: tempSug\n        });\n      }).catch(function (err) {\n        _this.setAddedFriend(\"couldn't find \" + search_val);\n      });\n    };\n\n    _this.confirmAdd = function (uid) {\n      _this.props.firebase.requests(uid).doc(_this.props.uid).set({\n        exists: true\n      }).then(function () {\n        _this.setAddedFriend('sent request!');\n      });\n    };\n\n    _this.addFriend = function () {\n      var ref = \"\";\n      var search_val = $('#add-friend-email').val();\n\n      if (_this.validateEmail(search_val)) {\n        //email = $('#add-friend-email').val();\n        ref = _this.props.firebase.users().where(\"email\", \"==\", search_val);\n      } else {\n        //name = $('#add-friend-email').val();\n        search_val = search_val.toLowerCase();\n        ref = _this.props.firebase.users().where(\"easy_name\", \"==\", search_val);\n      }\n\n      _this.genList(ref, search_val);\n    };\n\n    _this.inviteFriend = function () {\n      _this.setAddedFriend('invited!');\n    };\n\n    _this.acceptRequest = function (uid) {\n      //remove uid from your request\n      _this.removeRequest(uid);\n\n      _this.props.firebase.network(_this.props.uid).doc(uid).set({\n        exists: true\n      }).then(function () {});\n\n      _this.props.firebase.network(uid).doc(_this.props.uid).set({\n        exists: true\n      }).then(function () {}); //update their feed with your posts; update your feed with their posts\n\n\n      _this.props.firebase.feed(uid).where('uid', '==', uid).get().then(function (querySnapshot) {\n        querySnapshot.forEach(function (doc) {\n          _this.props.firebase.feed(_this.props.uid).doc(doc.id).set(doc.data());\n        });\n      });\n\n      _this.props.firebase.feed(_this.props.uid).where('uid', '==', _this.props.uid).get().then(function (querySnapshot) {\n        querySnapshot.forEach(function (doc) {\n          _this.props.firebase.feed(uid).doc(doc.id).set(doc.data());\n        });\n      });\n    };\n\n    _this.removeRequest = function (uid) {\n      _this.props.firebase.requests(_this.props.uid).doc(uid).delete();\n    };\n\n    _this.loadRequestUsers = function () {\n      _this.setState({\n        loading: true,\n        requestUsers: []\n      });\n\n      var users = [];\n      var counter = 0;\n\n      for (var i = 0; i < _this.state.requests.length; i++) {\n        var req = _this.state.requests[i]; // console.log(req)\n\n        _this.props.firebase.user(req).get().then(function (doc) {\n          users.push(doc.data()); // console.log(JSON.stringify(doc.data()));\n\n          _this.setState({\n            requestUsers: users\n          });\n\n          counter++;\n\n          if (counter === _this.state.requests.length) {\n            // console.log(\"done loading\");\n            _this.setState({\n              loading: false\n            });\n          }\n        });\n      }\n    };\n\n    _this.state = {\n      requests: _this.props.requests,\n      network: _this.props.network,\n      addedFriend: '',\n      invitedFriend: '',\n      loading: false,\n      suggestions: []\n    };\n    return _this;\n  }\n\n  _createClass(AddFriend, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.requests !== this.state.requests) {\n        this.setState({\n          requests: nextProps.requests\n        });\n      }\n\n      if (nextProps.network !== this.state.network) {\n        this.setState({\n          network: nextProps.network\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          requestUsers = _this$state.requestUsers,\n          requests = _this$state.requests;\n\n      if (requestUsers.length == 0 && requests.length > 0) {\n        if (this.state.loading == false) {\n          this.loadRequestUsers();\n        }\n      }\n\n      var addedFriend = React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, this.state.addedFriend);\n      var invitedFriend = React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, this.state.invitedFriend);\n      var req = [];\n\n      var _loop = function _loop() {\n        var uid = requests[i]; // console.log('changing request users in addfriends'  + uid);\n\n        var user = requestUsers[i];\n        addEl = React.createElement(\"div\", {\n          className: \"preview\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }, React.createElement(Avatar, {\n          PpfURL: user.PpfURL,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 191\n          },\n          __self: this\n        }), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192\n          },\n          __self: this\n        }, user.name), React.createElement(\"div\", {\n          className: \"yesno\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: \"yes\",\n          onClick: function onClick() {\n            return _this2.acceptRequest(uid);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"jam jam-check\",\n          style: {\n            color: 'white'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        })), React.createElement(\"button\", {\n          className: \"no\",\n          onClick: function onClick() {\n            return _this2.removeRequest(uid);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          className: \"jam jam-close\",\n          style: {\n            color: '#8A8184'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, \" \"))));\n        req.push(addEl);\n      };\n\n      for (var i = 0; i < requestUsers.length; i++) {\n        var addEl;\n\n        _loop();\n      }\n\n      var length = this.state.suggestions.length;\n      var suggestions = this.state.suggestions.map(function (sug, index) {\n        return React.createElement(UserRow, {\n          onProfileClick: function onProfileClick() {\n            return _this2.props.setUserPage(sug);\n          },\n          PpfURL: sug.url,\n          name: sug.name,\n          rightElement: React.createElement(\"button\", {\n            onClick: function onClick() {\n              return _this2.confirmAdd(sug.uid);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 213\n            },\n            __self: this\n          }, React.createElement(\"span\", {\n            className: \"jam jam-user-plus\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 214\n            },\n            __self: this\n          })),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 208\n          },\n          __self: this\n        });\n      });\n      return React.createElement(\"div\", {\n        className: \"modal network\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: \"close\",\n        onClick: function onClick() {\n          return _this2.props.setAddFriend(false);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"jam jam-close\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      })), React.createElement(\"img\", {\n        className: \"plant\",\n        src: plant,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 227\n        },\n        __self: this\n      }), req.length > 0 ? React.createElement(\"div\", {\n        className: \"scrolling-row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, req) : null, React.createElement(\"div\", {\n        className: \"add-friend\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, \"Find friends\"), addedFriend, React.createElement(\"div\", {\n        className: \"network-input\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        id: \"add-friend-email\",\n        type: \"email\",\n        placeholder: \"Search by name or email..\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 235\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: this.addFriend,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"jam jam-search\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      })))), React.createElement(\"div\", {\n        className: \"invite-friend\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, \"Invite friends to Newroots\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, \"Ask your close ones who're missing to join you.\"), invitedFriend, React.createElement(\"div\", {\n        className: \"network-input\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"email\",\n        placeholder: \"Enter their email..\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: this.inviteFriend,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }, \"invite\"))), length !== 0 ? React.createElement(\"h2\", {\n        className: \"friend-result-heading\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, 'Found ' + length + ' people on Newroots') : null, React.createElement(\"div\", {\n        className: \"friend-results\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, suggestions));\n    }\n  }]);\n\n  return AddFriend;\n}(React.Component);\n\n;\nexport default AddFriend;","map":{"version":3,"sources":["/Volumes/Angela He/treehacks/src/components/Network/AddFriend.js"],"names":["React","plant","$","Avatar","UserRow","ListOfUsers","AddFriend","props","setAddedFriend","mssg","setState","addedFriend","setInvitedFriend","invitedFriend","validateEmail","email","re","test","String","toLowerCase","genList","ref","search_val","tempSug","get","then","querySnapshot","forEach","doc","console","log","id","data","push","uid","name","url","PpfURL","suggestions","catch","err","confirmAdd","firebase","requests","set","exists","addFriend","val","users","where","inviteFriend","acceptRequest","removeRequest","network","feed","delete","loadRequestUsers","loading","requestUsers","counter","i","state","length","req","user","nextProps","addEl","color","map","sug","index","setUserPage","setAddFriend","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport plant from '../../graphics/icon.png';\nimport $ from 'jquery';\nimport Avatar from '../Misc/Avatar';\nimport UserRow from './UserRow'\nimport ListOfUsers from './ListOfUsers'\n\nclass AddFriend extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      requests: this.props.requests,\n      network: this.props.network,\n      addedFriend: '',\n      invitedFriend: '',\n      loading: false,\n      suggestions: []\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.requests !== this.state.requests) {\n      this.setState({ requests: nextProps.requests });\n    }\n    if (nextProps.network !== this.state.network) {\n      this.setState({ network: nextProps.network });\n    }\n  }\n\n  setAddedFriend = (mssg) => {\n    this.setState({\n      addedFriend: mssg\n    });\n  }\n\n  setInvitedFriend = (mssg) => {\n    this.setState({\n      invitedFriend: mssg\n    });\n  }\n\n  validateEmail = (email) => {\n    var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(String(email).toLowerCase());\n  }\n\n  genList = (ref, search_val) => {\n    let tempSug = [];\n    ref.get()\n      .then(querySnapshot => {\n        querySnapshot.forEach(function (doc) {\n          // doc.data() is never undefined for query doc snapshots\n          console.log(doc.id, \" => \", doc.data());\n          tempSug.push({\n            uid: doc.id,\n            name: doc.data().name,\n            url: doc.data().PpfURL\n          })\n        });\n        this.setState({\n          suggestions: tempSug\n        })\n      })\n      .catch(err => {\n        this.setAddedFriend(\"couldn't find \" + search_val);\n      });\n  }\n  confirmAdd = (uid) => {\n    this.props.firebase.requests(uid)\n      .doc(this.props.uid)\n      .set({ exists: true })\n      .then(() => {\n        this.setAddedFriend('sent request!');\n      });\n  }\n\n  addFriend = () => {\n    let ref = \"\";\n    let search_val = $('#add-friend-email').val();\n    if (this.validateEmail(search_val)) {\n      //email = $('#add-friend-email').val();\n      ref = this.props.firebase.users().where(\"email\", \"==\", search_val);\n    }\n    else {\n      //name = $('#add-friend-email').val();\n      search_val = search_val.toLowerCase();\n      ref = this.props.firebase.users().where(\"easy_name\", \"==\", search_val);\n    }\n\n\n    this.genList(ref, search_val);\n  };\n\n  inviteFriend = () => {\n    this.setAddedFriend('invited!');\n  };\n\n  acceptRequest = (uid) => {\n    //remove uid from your request\n    this.removeRequest(uid);\n\n    this.props.firebase.network(this.props.uid)\n      .doc(uid)\n      .set({ exists: true })\n      .then(() => { });\n\n    this.props.firebase.network(uid)\n      .doc(this.props.uid)\n      .set({ exists: true })\n      .then(() => { });\n\n    //update their feed with your posts; update your feed with their posts\n    this.props.firebase\n      .feed(uid).where('uid', '==', uid).get().then((querySnapshot) => {\n        querySnapshot.forEach((doc) => {\n\n          this.props.firebase\n            .feed(this.props.uid).doc(doc.id).set(doc.data());\n\n        });\n      });\n\n    this.props.firebase\n      .feed(this.props.uid).where('uid', '==', this.props.uid).get().then((querySnapshot) => {\n        querySnapshot.forEach((doc) => {\n\n          this.props.firebase\n            .feed(uid).doc(doc.id).set(doc.data());\n\n        });\n      });\n  }\n\n  removeRequest = (uid) => {\n    this.props.firebase.requests(this.props.uid).doc(uid).delete();\n  }\n\n  loadRequestUsers = () => {\n    this.setState({ loading: true, requestUsers: [] });\n    let users = [];\n    let counter = 0;\n    for (var i = 0; i < this.state.requests.length; i++) {\n      let req = this.state.requests[i];\n      // console.log(req)\n      this.props.firebase\n        .user(req).get().then((doc) => {\n          users.push(doc.data());\n          // console.log(JSON.stringify(doc.data()));\n          this.setState({ requestUsers: users });\n          counter++;\n          if (counter === this.state.requests.length) {\n            // console.log(\"done loading\");\n            this.setState({ loading: false });\n          }\n        });\n    }\n  }\n\n  render() {\n    let { requestUsers, requests } = this.state;\n\n\n\n    if (requestUsers.length == 0 && requests.length > 0) {\n      if (this.state.loading == false) {\n        this.loadRequestUsers();\n      }\n    }\n\n    let addedFriend = (\n      <p>\n        {this.state.addedFriend}\n      </p>\n    );\n\n    let invitedFriend = (\n      <p>\n        {this.state.invitedFriend}\n      </p>\n    );\n\n    let req = [];\n    for (var i = 0; i < requestUsers.length; i++) {\n\n      let uid = requests[i];\n      // console.log('changing request users in addfriends'  + uid);\n\n      let user = requestUsers[i];\n      var addEl = (\n        <div className=\"preview\">\n          <Avatar PpfURL={user.PpfURL} />\n          <p>{user.name}</p>\n          <div className=\"yesno\">\n            <button className=\"yes\" onClick={() => this.acceptRequest(uid)}>\n              <span className=\"jam jam-check\" style={{ color: 'white' }}></span>\n            </button>\n            <button className=\"no\" onClick={() => this.removeRequest(uid)}>\n              <span className=\"jam jam-close\" style={{ color: '#8A8184' }}> </span>\n            </button>\n          </div>\n        </div>\n      );\n      req.push(addEl);\n    }\n    let length = this.state.suggestions.length;\n\n    const suggestions = this.state.suggestions.map((sug, index) =>\n      <UserRow\n        onProfileClick={() => this.props.setUserPage(sug)}\n        PpfURL={sug.url}\n        name={sug.name}\n        rightElement={\n          <button onClick={() => this.confirmAdd(sug.uid)}>\n            <span className=\"jam jam-user-plus\" ></span>\n          </button>\n        }\n      />\n    );\n\n    return (\n      <div className=\"modal network\">\n        <button className=\"close\" onClick={() => this.props.setAddFriend(false)}>\n\n\n          <span className=\"jam jam-close\"></span>\n        </button>\n        <img className=\"plant\" src={plant}></img>\n\n        {req.length > 0 ? <div className=\"scrolling-row\">{req}</div> : null}\n\n        <div className=\"add-friend\">\n          <h2>Find friends</h2>\n          {addedFriend}\n          <div className=\"network-input\">\n            <input id=\"add-friend-email\" type=\"email\" placeholder=\"Search by name or email..\"></input>\n            <button onClick={this.addFriend}>\n              <span className=\"jam jam-search\" ></span>\n            </button>\n          </div>\n        </div>\n        <div className=\"invite-friend\">\n          <h2>Invite friends to Newroots</h2>\n          <p>Ask your close ones who're missing to join you.</p>\n          {invitedFriend}\n          <div className=\"network-input\">\n            <input type=\"email\" placeholder=\"Enter their email..\"></input>\n            <button onClick={this.inviteFriend}>invite</button>\n          </div>\n        </div>\n        {length !== 0 ?\n          <h2 className=\"friend-result-heading\">{'Found ' + length + ' people on Newroots'}</h2> : null}\n\n        <div className=\"friend-results\">\n          {suggestions}\n        </div>\n\n      </div>\n    );\n  }\n};\n\nexport default AddFriend;"]},"metadata":{},"sourceType":"module"}